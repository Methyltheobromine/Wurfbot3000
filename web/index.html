<!doctype html>
<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <title>Wurfbot3000</title>
        <meta name="viewport" content="width=device-width">
        <meta name="author" content="Eggermann Severin">
        <link rel="stylesheet" href="myStyle.css" type="text/css" title="Standard">

        <style>
            #links{
                width: 50%;
                float: left;
                height: 250px;
            }

            #rechts{
                float: right;
                width: 50%;
                height: 250px;
            }
        </style>
    </head>

    <body>
        <div id="website">
            <div id="header" class="rund">
                <br /> 
                <h1><br> Pren 2 - Team 37 </h1>
                <p> Wurfbot3000</p>
                <hr />

            </div>
            <div id="main">
                <div>
                    <div id="links">
                        <br /> 	
                        Bitte Verbindung zuerst aufbauen:
                        <button id="buttonOpenClose" class="button_klasse rot" type="button" onclick="openSocket();" >Verbindung aufbauen</button>
                        <div>
                            <button id="buttonInit" class="button_klasse blau" type="button" onclick="initialisierungWurfbot();" >Initialisierung</button>
                            <button id="buttonStart" class="button_klasse blau" type="button" onclick="startWurfbot();" >Start Wurfbot3000</button>
                            <button id="buttonConfig" class="button_klasse blau" type="button" onclick="getProperties();" >Config-File auslesen</button>
                            <button id="buttonClear" class="button_klasse blau" type="button" onclick="clearLogs();" >Clear Log</button>
                        </div>
                        <br /> 
                        <div>
                            Bitte den neuen Wert passend zum Schluessel eingeben.  Bsp.:   dcSPEED;99999 <br /> 
                            <input type="text" id="messageinput"/>
                        </div>
                        <div>
                            <button id="buttonConfig" class="button_klasse blau" type="button" onclick="changeConfigFile();" >Konfigurationsparameter anpassen</button>
                        </div>
                    </div>

                    <div id="rechts">
                        <br /> <br /> 
                        <div id="property"></div>
                    </div>
                </div>

                <div>
                    <div id="links">
                        LogAusgabe:
                        <!-- Server responses get written here -->
                        <div id="messages"></div>
                    </div>

                    <div id="rechts">
                        <div> 
                            <img src="wurfbot.jpg" alt="CHEF" />
                        </div>
                    </div>
                </div>

            </div>



        </div>

        <!-- Script to utilise the WebSocket -->
        <script type="text/javascript">

            var webSocket;
            var initialized = 0;
            var messages = document.getElementById("messages");
            var propertyconfig = document.getElementById("property");

            function initialisierungWurfbot() {
                //messages.innerHTML = "";
                if (checkConnection() === 1) {
                    return;
                }
                writeResponse("Start Initialisierung Wurfbot3000");
                var text = "INITPOS";
                webSocket.send(text);
            }

            function clearLogs() {
                messages.innerHTML = "";
            }

            function startWurfbot() {
                //messages.innerHTML = "";
                if (checkConnection() === 1) {
                    return;
                }
                writeResponse("Start Autonomer Ablauf Wurfbot3000");
                var text = "START";
                webSocket.send(text);
            }

            function changeConfigFile() {
                //messages.innerHTML = "";
                if (checkConnection() === 1) {
                    return;
                }
                var text = document.getElementById("messageinput").value;
                webSocket.send("CONF:" + text);
            }

            function getProperties() {
                if (checkConnection() === 1) {
                    return;
                }
                var text = "GETCONF";
                webSocket.send(text);
            }

            function writeResponse(text) {
                var textLen = text.length;
                if (textLen < 150) {
                    messages.innerHTML += "<br/>" + text;
                } else {
                    propertyconfig.innerHTML = text;
                }

            }

            function init() {
                if (initialized == 0) {
                    webSocket.onopen = function (event) {
                        document.getElementById("buttonOpenClose").innerHTML = 'Verbindung schliessen';
                        document.getElementById("buttonOpenClose").className = 'button_klasse gruen';
                        writeResponse("event.data");
                    };

                    webSocket.onmessage = function (event) {
                        writeResponse(event.data);
                    };

                    webSocket.onclose = function (event) {
                        initialized = 0;
                        document.getElementById("buttonOpenClose").innerHTML = 'Verbindung aufbauen';
                        document.getElementById("buttonOpenClose").className = 'button_klasse rot'
                        writeResponse("Connection Closed");
                    };

                    initialized = 1;
                }
            }

            function checkConnection() {
                if (webSocket === undefined || webSocket.readyState === WebSocket.CLOSED) {
                    writeResponse("Bitte zuerst Verbindung aufbauen. Merrciiiii")

                    return 1;
                } else {
                    //writeResponse("Verbidnung ok");
                    return 0;
                }
            }

            function openSocket() {
                //messages.innerHTML = "";
                // Ensures only one connection is open at a time
                if (webSocket !== undefined && webSocket.readyState !== WebSocket.CLOSED) {
                    writeResponse("Connection Closing...");
                    document.getElementById("buttonOpenClose").innerHTML = 'Verbindung aufbauen';
                    document.getElementById("buttonOpenClose").className = 'button_klasse rot'
                    webSocket.close();
                    return;
                }

                // Create a new instance of the websocket
                webSocket = new WebSocket("ws://192.168.37.1:8080/WurfbotService/wurfbot");

                if (checkConnection() === 1) {
                    writeResponse("Verbindungsaufbau nicht m√∂glich")
                    return;
                }

                init();
                //webSocket.send("INITPOS");
                //writeResponse("Vor onOpen");
                //webSocket.send("INITPOS");
                //webSocket.onopen();
                document.getElementById("buttonOpenClose").innerHTML = 'Verbindung schliessen';
                document.getElementById("buttonOpenClose").className = 'button_klasse gruen';
            }

        </script>

    </body>
</html>